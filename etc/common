# elrond

ELROND_HOME=${TOPLEVEL:="${ELROND_HOME}"}
ELROND_HOME=$(cd "${ELROND_HOME}"; pwd)
export ELROND_HOME

ELROND_BIN="${ELROND_HOME}"/bin
export ELROND_BIN

ELROND_ETC="${ELROND_HOME}"/etc
export ELROND_ETC

ELROND_LIB="${ELROND_HOME}"/lib
export ELROND_LIB

ELROND_SHARE="${ELROND_HOME}"/share
export ELROND_SHARE

ELROND_SRC="${ELROND_HOME}"/src
export ELROND_SRC

ELROND_VAR="${ELROND_HOME}"/var
export ELROND_VAR

ELROND_DATA="${ELROND_VAR}"/data
export ELROND_DATA

ELROND_DB="${ELROND_VAR}"/db
export ELROND_DB

ELROND_LOG="${ELROND_VAR}"/log
export ELROND_LOG

ELROND_RUN="${ELROND_VAR}"/run
export ELROND_RUN

ELROND_WWW="${ELROND_HOME}"/www
export ELROND_WWW

ELROND_DEPENDS="$(cat ${ELROND_SHARE}/depends.list)"
export ELROND_DEPENDS

ELROND_CONFIGUREFLAGS="--prefix=${ELROND_HOME}" 
export ELROND_CONFIGUREFLAGS

ELROND_LOGFILE="${ELROND_LOG}"/elrond.log
export ELROND_LOGFILE

function record
{
        date            >> "${ELROND_LOGFILE}"
        echo "$1"       >> "${ELROND_LOGFILE}"
}

function recorde
{
        record  "$1"
        echo    "$1"
}

# native

PATH="${ELROND_BIN}":"${PATH}"
export PATH

PATH=/sbin:/usr/sbin:"${PATH}"
export PATH

LD_LIBRARY_PATH="${ELROND_LIB}":"${LD_LIBRARY_PATH}"
export LD_LIBRARY_PATH

ELROND_ACLOCALFLAGS="-I ${ELROND_SHARE}/aclocal"
export ELROND_ACLOCALFLAGS

for x in ${ELROND_DEPENDS}; do
        [ ! -d /opt/${x} ] && continue

        PATH="/opt/${x}/bin:/opt/${x}/sbin:${PATH}"
        export PATH

        LD_LIBRARY_PATH="/opt/${x}/lib:${LD_LIBRARY_PATH}"
        export LD_LIBRARY_PATH

        PKG_CONFIG_PATH="/opt/${x}/lib/pkgconfig:${PKG_CONFIG_PATH}"
        export PKG_CONFIG_PATH

        ACLOCAL="/opt/${x}/share/aclocal"
        [ ! -d ${ACLOCAL} ] && continue
        ELROND_ACLOCALFLAGS="-I ${ACLOCAL} ${ELROND_ACLOCALFLAGS}"
done

SVNHOST=dev.creativedigitalsys.com
export SVNHOST

SVN=$(which svn)
export SVN

SVNFLAGS=
export SVNFLAGS

CC=$(which gcc)
export CC

CFLAGS=${CFLAGS:="-O0 -std=c99 -Wall -Werror"}

if [ ! "${DEBUG}" = "" ]; then
        CFLAGS="${CFLAGS} -g"
fi

export CFLAGS

MAKE=$(which make)
export MAKE

MAKEFLAGS=${MAKEFLAGS:="-k"}
export MAKEFLAGS

SWIG=$(which swig)
export SWIG

SWIGFLAGS=
export SWIGFLAGS

# python

PYTHON="$(which python)"
export PYTHON

PYTHONFLAGS="-tt"

if [ ! "$DEBUG" = "" ]; then
   PYTHONFLAGS="${PYTHONFLAGS} -m trace -t"
fi

export PYTHONFLAGS

PYTHONPATH=${LD_LIBRARY_PATH}:${PYTHONPATH}
PYTHONPATH=${ELROND_LIB}:${ELROND_LIB}/python:${PYTHONPATH}
export PYTHONPATH

for x in ${ELROND_DEPENDS}; do
        [ ! -d /opt/${x} ] && continue

        PYTHONPATH=/opt/${x}/lib:/opt/${x}/lib/python:${PYTHONPATH}
        export PYTHONPATH
done

# java

NETBEANS_HOME=/usr/share/netbeans
if [ -d /opt/netbeans ]; then
        NETBEANS_HOME=/opt/netbeans
fi
export NETBEANS_HOME

NETBEANS=netbeans
export NETBEANS

NETBEANSFLAGS=
export NETBEANSFLAGS

PATH=${NETBEANS_HOME}/bin:${PATH}
export PATH

CLASSPATH=

for x in ${ELROND_HOME}/dist/*.jar ${ELROND_HOME}/lib/java/*.jar; do
        CLASSPATH="${x}:${CLASSPATH}"
done

for x in ${EXTRAS}; do
        for y in /opt/${x}/lib/*.jar; do
                CLASSPATH="${y}:${CLASSPATH}"
        done
done

JAVA_MODULES="                                                          \
        /usr/share/java/commons-cli.jar                                 \
        /usr/share/java/commons-daemon.jar                              \
        ${NETBEANS_HOME}/java2/modules/ext/AbsoluteLayout.jar           \
        ${NETBEANS_HOME}/platform9/modules/ext/swing-layout-1.0.3.jar   \
        ${NETBEANS_HOME}/platform9/modules/ext/junit-4.5.jar            \
"

for x in ${JAVA_MODULES}; do
        CLASSPATH="${x}:${CLASSPATH}"
done

export CLASSPATH

XXX="${JAVA_HOME}"

# Debian/Ubuntu & Fedora Core x86
XXX="${XXX} /usr/lib/jvm/java-6-sun"

# Debian/Ubuntu & Fedora Core ppc
XXX="${XXX} /usr/lib/j2sdk1.6-ibm"

# Yellowdog 3/4
XXX="${XXX} /opt/java"

for x in ${XXX}; do
        [ ! -d ${x} ] && continue

        JAVA_HOME=${x}
        export JAVA_HOME

        break
done

PATH=${JAVA_HOME}/bin:${PATH}
export PATH

JAVA=$(which java)
export JAVA

JAVAFLAGS=
JAVAFLAGS="${JAVAFLAGS} -Delrond.home=${ELROND_HOME}"
JAVAFLAGS="${JAVAFLAGS} -Djava.library.path=${LD_LIBRARY_PATH}"
JAVAFLAGS="${JAVAFLAGS} \
        -Djava.util.logging.config.file=${ELROND_ETC}/elrond.properties"

if [ ! "${DEBUG}" = "" ]; then
        JAVAFLAGS="${JAVAFLAGS}"
        # JAVAFLAGS="${JAVAFLAGS} -Dcom.sun.management.jmxremote"
        # JAVAFLAGS="${JAVAFLAGS} -Xdebug -agentlib:jdwp=transport=dt_socket,server=y,address=8000"
fi

export JAVAFLAGS

ANT=$(which ant)
export ANT

ANTFLAGS="-Dplatform.home=\"${JAVA_HOME}\" -emacs"

if [ ! "${DEBUG}" = "" ]; then
        ANTFLAGS="${ANTFLAGS} -Djavac.debug=true"
fi

export ANTFLAGS

JSVC= # TODO: $(which jsvc)
export JSVC

JSVCFLAGS=
JSVCFLAGS="${JSVCFLAGS} ${JAVAFLAGS}"
JSVCFLAGS="${JSVCFLAGS} -cp ${CLASSPATH} -user ${USER}"
export JSVCFLAGS

# extras

ELROND_EXTRAS="                      \
"

for x in ${ELROND_EXTRAS}; do
        TOPLEVEL=${ELROND_HOME}/extras/${x}
        . ${TOPLEVEL}/etc/common
done

